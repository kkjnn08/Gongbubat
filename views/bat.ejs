<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>밭</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
</head>
    <style>
        /* body{
            width: 1130px;
            margin: 0 auto;
        } */
    </style>
<body>
    <!-- nav bar -->
    <%- include('nav.html') %>

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>

    <h3 class="text-center mt-4 mb-4 d-flex justify-content-center" id="viewTitle">밭</h3>
    <div class="container">
        <div class="row col-md-12 col-lg-10 mx-auto">
            <div class="flex-row">
                <div class="d-grid d-flex justify-content-end">
                    <button class="btn btn-primary btn-sm" type="button" id="btn-homework-setting">숙제 관리</button>
                </div>
            </div>
            <p class="text-center"><%=todayHomework%></p>
            <% members.forEach(mem=>{ %>
                <h6><%=mem%></h6>
                <div class="mb-4 border border-1 rounded-3 pt-2">
                    <div class="d-flex flex-row memids" id="<%=mem%>">
                        <% homeworks.forEach(hw=>{ %>
                            <div class="d-flex flex-column mx-auto text-center">
                                <div class="show-date-<%=hw.date.d%>"><%=hw.date.d%></div>
                                <!-- <div id="<%=mem%>-<%=hw.date.d%>"></div> -->
                                <div><i class="bi bi-check-lg <%=hw.date.d%>" id="<%=mem%>-<%=hw.date.d%>"></i></div>
                            </div>
                        <% }) %>
                    </div>
                </div> 
            <% }) %>
        </div>
    </div>

    <script>
        //현재 날짜(nnnn년 n월 n일) 가져오기
        //연, 월
        const nowdate = new Date()
        const thisYear = nowdate.getFullYear()
        const thisMonth = nowdate.getMonth()+1
        // console.log(thisYear, thisMonth)
        //일
        const prevLast = new Date(thisYear, thisMonth-1, 0) //저번 달 마지막 날
        const lastDate = new Date(thisYear, thisMonth, 0).getDate() //이번 달 마지막 날
        const thisDates = [...Array(lastDate+1).keys()].splice(1)
        console.log(thisDates)
        //요일
        const thisFirstDay = (prevLast.getDay()+1)%7 //이번 달 1일 요일
        console.log(thisFirstDay)

        //오늘 날짜
        const today = nowdate.getDate()
        // console.log(today)

        //오늘 날짜 강조
        $('.show-date-'+today).css('background-color','#F16A6E')
        $('.show-date-'+today).css('color','white')
        $('.show-date-'+today).css('border-radius','6px')


        //숙제관리 페이지로 이동
        $('#btn-homework-setting').click(()=>{
            location.href='/homework'
        })

        //1일에서 오늘날짜까지만 아이콘 보여주기, 나머지는 hidden
        const hiddenIcons = [...thisDates].splice(today)
        // console.log(hiddenIcons)

        console.log($('.memids'))
        $('.memids').each((index, mem)=>{
            hiddenIcons.forEach(icon=>{
            $('#'+mem.id+'-'+icon).css('visibility', 'hidden')
            })
        })

        //update
        //클릭 가능한 아이콘 id: 'member_id-date' (예) firstID-31)
        $('.'+today).css('cursor','pointer').click((e)=>{
            console.log(e.target.id)
        })
    </script>
</body>
</html>